# Data Model: Textify Content Extraction Tool

**Date**: 2025-09-27  
**Feature**: Content extraction from YouTube videos and Naver blogs

## Core Entities

### 1. URL

사용자가 입력한 웹 링크를 나타내는 엔티티

```typescript
interface URL {
  value: string; // 원본 URL 문자열
  type: 'youtube' | 'naver' | 'unknown'; // URL 타입
  isValid: boolean; // URL 유효성 여부
  normalizedUrl?: string; // 정규화된 URL (선택적)
}
```

**Validation Rules**:

- YouTube: `youtube.com/watch?v=` 또는 `youtu.be/` 패턴
- Naver: `blog.naver.com` 도메인
- URL 형식 검증 (RFC 3986 준수)

### 2. ExtractedContent

추출된 콘텐츠의 핵심 데이터

```typescript
interface ExtractedContent {
  id: string; // 고유 식별자 (UUID)
  sourceUrl: string; // 원본 URL
  sourceType: 'youtube' | 'naver';
  title: string; // 콘텐츠 제목
  content: string; // 추출된 텍스트 내용
  language?: string; // 콘텐츠 언어 (YouTube 자막용)
  timestamp: Date; // 추출 시간
  metadata: ContentMetadata; // 추가 메타데이터
}
```

### 3. ContentMetadata

콘텐츠별 추가 정보

```typescript
interface ContentMetadata {
  // YouTube 전용
  videoId?: string; // YouTube 비디오 ID
  duration?: number; // 비디오 길이 (초)
  availableLanguages?: string[]; // 사용 가능한 자막 언어
  hasTimestamps?: boolean; // 타임스탬프 포함 여부

  // Naver 블로그 전용
  blogId?: string; // 블로그 ID
  postId?: string; // 포스트 ID
  author?: string; // 작성자
  publishDate?: Date; // 발행일

  // 공통
  extractionMethod: string; // 추출 방법
  processingTime: number; // 처리 시간 (ms)
  contentLength: number; // 콘텐츠 길이
}
```

### 4. SubtitleTrack

YouTube 자막 트랙 정보

```typescript
interface SubtitleTrack {
  language: string; // 언어 코드 (예: 'ko', 'en')
  languageName: string; // 언어 이름 (예: '한국어', 'English')
  isAutoGenerated: boolean; // 자동 생성 자막 여부
  url: string; // 자막 파일 URL
  format: 'srt' | 'vtt' | 'ttml'; // 자막 형식
}
```

### 5. ExtractionResult

추출 작업의 전체 결과

```typescript
interface ExtractionResult {
  success: boolean; // 성공 여부
  data?: ExtractedContent; // 성공 시 추출된 데이터
  error?: ExtractionError; // 실패 시 에러 정보
  processingTime: number; // 총 처리 시간 (ms)
  timestamp: Date; // 처리 완료 시간
}
```

### 6. ExtractionError

추출 실패 시 에러 정보

```typescript
interface ExtractionError {
  code: string; // 에러 코드
  message: string; // 사용자 친화적 메시지
  details?: string; // 상세 에러 정보 (개발용)
  retryable: boolean; // 재시도 가능 여부
}
```

**Error Codes**:

- `INVALID_URL`: 잘못된 URL 형식
- `UNSUPPORTED_PLATFORM`: 지원하지 않는 플랫폼
- `CONTENT_NOT_FOUND`: 콘텐츠를 찾을 수 없음
- `NO_SUBTITLES`: 자막이 없음 (YouTube)
- `EXTRACTION_FAILED`: 추출 실패
- `TIMEOUT`: 처리 시간 초과
- `RATE_LIMITED`: API 할당량 초과

### 7. UserSession

사용자 세션 데이터 (클라이언트 사이드)

```typescript
interface UserSession {
  sessionId: string; // 세션 ID
  recentExtractions: ExtractedContent[]; // 최근 추출 기록 (최대 10개)
  preferences: UserPreferences; // 사용자 설정
  createdAt: Date; // 세션 생성 시간
  lastActivity: Date; // 마지막 활동 시간
}
```

### 8. UserPreferences

사용자 설정

```typescript
interface UserPreferences {
  defaultLanguage: string; // 기본 자막 언어
  showTimestamps: boolean; // 타임스탬프 표시 여부
  theme: 'light' | 'dark' | 'system'; // 테마 설정
  autoSave: boolean; // 자동 저장 여부
}
```

## State Transitions

### URL Processing Flow

```
입력 → 유효성 검사 → 타입 분류 → 정규화 → 추출 준비
```

### Content Extraction Flow

```
URL 수신 → 플랫폼 식별 → 콘텐츠 fetch → 파싱 → 정리 → 결과 반환
```

### Error Handling Flow

```
에러 발생 → 에러 분류 → 재시도 가능성 판단 → 사용자 메시지 생성 → 응답
```

## Data Validation

### Input Validation

- URL 형식 검증 (Zod 스키마)
- 지원 플랫폼 확인
- 악성 URL 필터링

### Output Validation

- 추출된 콘텐츠 길이 제한 (최대 100KB)
- 텍스트 인코딩 검증
- 메타데이터 완성도 확인

## Storage Strategy

### Client-side Storage

- LocalStorage: 사용자 설정 및 최근 기록
- SessionStorage: 임시 추출 결과
- IndexedDB: 대용량 콘텐츠 캐싱 (선택적)

### Server-side Storage

- 무상태 설계: Worker에 데이터 저장하지 않음
- 캐싱: Cloudflare Cache API 활용 (정적 자산 + API 응답)
- 로그: 기본적인 사용 통계만 수집
- 통합 서빙: 하나의 Worker에서 정적 자산과 API 모두 처리

## Performance Considerations

### Memory Management

- 대용량 콘텐츠 스트리밍 처리
- 불필요한 데이터 즉시 해제
- 메모리 사용량 모니터링

### Caching Strategy

- API 응답 캐싱 (TTL: 1시간)
- 정적 자원 캐싱
- 브라우저 캐시 활용

## Security Considerations

### Input Sanitization

- URL 검증 및 새니타이징
- XSS 방지를 위한 텍스트 이스케이핑
- CSRF 토큰 (필요시)

### Data Privacy

- 사용자 데이터 최소 수집
- 개인정보 포함 콘텐츠 처리 주의
- 로그에서 민감 정보 제외
